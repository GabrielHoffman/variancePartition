<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Variance partitioning analysis • variancePartition</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Variance partitioning analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">variancePartition</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.39.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/variancePartition.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/dream.html">dream analysis</a></li>
    <li><a class="dropdown-item" href="../articles/rnd_effects.html">Theory and practice of random effects</a></li>
    <li><a class="dropdown-item" href="../articles/mvtests.html">Multivariate tests</a></li>
    <li><a class="dropdown-item" href="../articles/additional_visualization.html">Additional visualizations of variance structure</a></li>
    <li><a class="dropdown-item" href="../articles/errors.html">Error handling</a></li>
    <li><a class="dropdown-item" href="../articles/FAQ.html">Frequently asked questions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DiseaseNeuroGenomics/variancePartition/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Variance partitioning analysis</h1>
                        <h4 data-toc-skip class="author">Developed by <a href="http://gabrielhoffman.github.io/" class="external-link">Gabriel Hoffman</a>
</h4>
            
            <h4 data-toc-skip class="date">Run on 2025-10-29
14:10:27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DiseaseNeuroGenomics/variancePartition/blob/HEAD/vignettes/variancePartition.Rmd" class="external-link"><code>vignettes/variancePartition.Rmd</code></a></small>
      <div class="d-none name"><code>variancePartition.Rmd</code></div>
    </div>

    
    
<!---
cd /Users/gabrielhoffman/workspace/repos
R
rmarkdown::render('variancePartition.Rmd')

--->
<style>
body {
text-align: justify}
</style>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Gene expression datasets are complicated and have multiple sources of
biological and technical variation. These datasets have recently become
more complex as it is now feasible to assay gene expression from the
same individual in multiple tissues or at multiple time points. The
<code>variancePartition</code> package implements a statistical method
to quantify the contribution of multiple sources of variation and
decouple within/between-individual variation. In addition,
<code>variancePartition</code> produces results at the gene-level to
identity genes that follow or deviate from the genome-wide trend.</p>
<p>The <code>variancePartition</code> package provides a general
framework for understanding drivers of variation in gene expression in
experiments with complex designs. A typical application would consider a
dataset of gene expression from individuals sampled in multiple tissues
or multiple time points where the goal is to understand variation within
versus between individuals and tissues. <code>variancePartition</code>
use a linear mixed model to partition the variance attributable to
multiple variables in the data. The analysis is built on top of the
<code>lme4</code> package <span class="citation">(Bates et al.
2015)</span>, and some basic knowledge about linear mixed models will
give you some intuition about the behavior of
<code>variancePartition</code> <span class="citation">(Pinheiro and
Bates 2000; Galecki and Burzykowski 2013)</span>.</p>
<div class="section level3">
<h3 id="input-data">Input data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h3>
<p>There are three components to an analysis:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Gene expression data:</strong> In general, this is a matrix
of normalized gene expression values with genes as rows and experiments
as columns.</li>
</ol>
<ul>
<li>
<p>Count-based quantification: <code>featureCounts</code> <span class="citation">(Liao et al. 2014)</span>, <code>HTSeq</code> <span class="citation">(Anders et al. 2015)</span></p>
<p>Counts mapping to each gene can be normalized using counts per
million (CPM), reads per kilobase per million (RPKM) or fragments per
kilobase per million (FPKM). These count results can be processed with
<code><a href="https://rdrr.io/pkg/limma/man/voom.html" class="external-link">limma::voom()</a></code> <span class="citation">(Law et al.
2014)</span> to model the precision of each observation or
<code>DESeq2</code> <span class="citation">(Love et al.
2014)</span>.</p>
</li>
<li>
<p>Isoform quantification: <code>kallisto</code> <span class="citation">(Bray et al. 2016)</span>, <code>sailfish</code> <span class="citation">(Patro et al. 2014)</span>, <code>salmon</code> <span class="citation">(Patro et al. 2015)</span>, <code>RSEM</code> <span class="citation">(Li and Dewey 2011)</span>, <code>cufflinks</code>
<span class="citation">(Trapnell et al. 2010)</span></p>
<p>These perform isoform-level quantification using reads that map to
multiple transcripts. Quantification values can be read directly into R,
or processed with <code>ballgown</code> <span class="citation">(Frazee
et al. 2015)</span> or <code>tximport</code> <span class="citation">(Soneson et al. 2015)</span>.</p>
</li>
<li><p>Microarray data: any standard normalization such as
<code>rma</code> in the <code>oligo</code> <span class="citation">(Carvalho and Irizarry 2010)</span> package can be
used.</p></li>
<li><p>Any set of features: chromatin accessibility, protein
quantification, etc</p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>
<p><strong>Metadata about each experiment:</strong></p>
<p>A <code>data.frame</code> with information about each experiment such
as patient ID, tissue, sex, disease state, time point, batch,
etc.</p>
</li>
<li>
<p><strong>Formula indicating which metadata variables to
consider:</strong></p>
<p>An R formula such as
<code>~ Age + (1|Individual) + (1|Tissue) + (1|Batch)</code> indicating
which metadata variables should be used in the analysis.</p>
</li>
</ol>
<p>Variance partitioning analysis will assess the contribution of each
metadata variable to variation in gene expression and can report the
intra-class correlation for each variable.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-an-analysis">Running an analysis<a class="anchor" aria-label="anchor" href="#running-an-analysis"></a>
</h2>
<p>A typical analysis with <code>variancePartition</code> is only a few
lines of R code, assuming the expression data has already been
normalized. Normalization is a separate topic addressed briefly in
[Applying <code>variancePartition</code> to RNA-seq expression
data].</p>
<p>The simulated dataset included as an example contains measurements of
200 genes from 100 samples. These samples include assays from 3 tissues
across 25 individuals processed in 4 batches. The individuals range in
age from 36 to 73. A typical <code>variancePartition</code> analysis
will assess the contribution of each aspect of the study design
(i.e. individual, tissue, batch, age) to the expression variation of
each gene. The analysis will prioritize these axes of variation based on
a genome-wide summary and give results at the gene-level to identity
genes that follow or deviate from this genome-wide trend. The results
can be visualized using custom plots and can be used for downstream
analysis.</p>
<div class="section level3">
<h3 id="standard-application">Standard application<a class="anchor" aria-label="anchor" href="#standard-application"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://bioconductor.org/packages/variancePartition" class="external-link">"variancePartition"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load simulated data:</span></span>
<span><span class="co"># geneExpr: matrix of gene expression values</span></span>
<span><span class="co"># info: information/metadata about each sample</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">varPartData</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify variables to consider</span></span>
<span><span class="co"># Age is continuous so model it as a fixed effect</span></span>
<span><span class="co"># Individual and Tissue are both categorical,</span></span>
<span><span class="co"># so model them as random effects</span></span>
<span><span class="co"># Note the syntax used to specify random effects</span></span>
<span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">Age</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Individual</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Tissue</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Batch</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit model and extract results</span></span>
<span><span class="co"># 1) fit linear mixed model on gene expression</span></span>
<span><span class="co"># If categorical variables are specified,</span></span>
<span><span class="co">#     a linear mixed model is used</span></span>
<span><span class="co"># If all variables are modeled as fixed effects,</span></span>
<span><span class="co">#       a linear model is used</span></span>
<span><span class="co"># each entry in results is a regression model fit on a single gene</span></span>
<span><span class="co"># 2) extract variance fractions from each model fit</span></span>
<span><span class="co"># for each gene, returns fraction of variation attributable</span></span>
<span><span class="co">#       to each variable</span></span>
<span><span class="co"># Interpretation: the variance explained by each variables</span></span>
<span><span class="co"># after correcting for all other variables</span></span>
<span><span class="co"># Note that geneExpr can either be a matrix,</span></span>
<span><span class="co"># and EList output by voom() in the limma package,</span></span>
<span><span class="co"># or an ExpressionSet</span></span>
<span><span class="va">varPart</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel</a></span><span class="op">(</span><span class="va">geneExpr</span>, <span class="va">form</span>, <span class="va">info</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sort variables (i.e. columns) by median fraction</span></span>
<span><span class="co">#       of variance explained</span></span>
<span><span class="va">vp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sortCols-method.html">sortCols</a></span><span class="op">(</span><span class="va">varPart</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 1a</span></span>
<span><span class="co"># Bar plot of variance fractions for the first 10 genes</span></span>
<span><span class="fu"><a href="../reference/plotPercentBars-method.html">plotPercentBars</a></span><span class="op">(</span><span class="va">vp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="variancePartition_files/figure-html/simResult-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 1b</span></span>
<span><span class="co"># violin plot of contribution of each variable to total variance</span></span>
<span><span class="fu"><a href="../reference/plotVarPart-method.html">plotVarPart</a></span><span class="op">(</span><span class="va">vp</span><span class="op">)</span></span></code></pre></div>
<p><img src="variancePartition_files/figure-html/simResult-2.png" width="384" style="display: block; margin: auto;"></p>
<p><code>variancePartition</code> includes a number of custom plots to
visualize the results. Since <code>variancePartition</code> attributes
the fraction of total variation attributable to each aspect of the study
design, these fractions naturally sum to 1. plots the partitioning
results for a subset of genes (Figure 1a), and shows a genome-wide
violin plot of the distribution of variance explained by each variable
across all genes (Figure 1b). (Note that these plots show results in
terms of of variance explained, while the results are stored in terms of
the <u>fraction</u>.)</p>
<p>The core functions of <code>variancePartition</code> work seemlessly
with gene expression data stored as a <code>matrix</code>,
<code>data.frame</code>, <code>EList</code> from <code>limma</code> or
<code>ExpressionSet</code> from <code>Biobase</code>.
<code><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel()</a></code> returns an object that stores the
variance fractions for each gene and each variable in the formula
specified. These fractions can be accessed just like a
<code>data.frame</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Access first entries</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">varPart</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             Batch Individual     Tissue          Age  Residuals</span></span>
<span><span class="co">## gene1 0.000157942  0.8903734 0.02468870 4.528911e-05 0.08473466</span></span>
<span><span class="co">## gene2 0.000000000  0.8060315 0.10101913 3.336681e-04 0.09261569</span></span>
<span><span class="co">## gene3 0.002422410  0.8901149 0.03561726 1.471692e-03 0.07037370</span></span>
<span><span class="co">## gene4 0.000000000  0.7688280 0.12531345 1.014413e-03 0.10484417</span></span>
<span><span class="co">## gene5 0.000000000  0.6997242 0.20910145 3.871487e-05 0.09113564</span></span>
<span><span class="co">## gene6 0.002343666  0.7222283 0.16786542 2.717378e-03 0.10484521</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Access first entries for Individual</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">varPart</span><span class="op">$</span><span class="va">Individual</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.8903734 0.8060315 0.8901149 0.7688280 0.6997242 0.7222283</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sort genes based on variance explained by Individual</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">varPart</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">varPart</span><span class="op">$</span><span class="va">Individual</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               Batch Individual      Tissue          Age  Residuals</span></span>
<span><span class="co">## gene43  0.000000000  0.9143523 0.011737173 3.776742e-04 0.07353288</span></span>
<span><span class="co">## gene174 0.000000000  0.9112702 0.009726000 2.015102e-03 0.07698866</span></span>
<span><span class="co">## gene111 0.000000000  0.9067082 0.008386574 9.735963e-04 0.08393164</span></span>
<span><span class="co">## gene127 0.000000000  0.9035627 0.013838829 5.081821e-04 0.08209027</span></span>
<span><span class="co">## gene151 0.006079206  0.9029393 0.000000000 1.345019e-05 0.09096803</span></span>
<span><span class="co">## gene91  0.000000000  0.9002946 0.014144935 1.110517e-06 0.08555939</span></span></code></pre>
<div class="section level5">
<h5 id="saving-plot-to-file">Saving plot to file<a class="anchor" aria-label="anchor" href="#saving-plot-to-file"></a>
</h5>
<p>In order to save the plot to a file, use the <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave()</a></code>
function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fig</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotVarPart-method.html">plotVarPart</a></span><span class="op">(</span><span class="va">vp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">fig</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="plot-expression-stratified-by-other-variables">Plot expression stratified by other variables<a class="anchor" aria-label="anchor" href="#plot-expression-stratified-by-other-variables"></a>
</h4>
<p><code>variancePartition</code> also includes plotting functions to
visualize the variation across a variable of interest. plots the
expression of a gene stratified by the specified variable. In the
example dataset, users can plot a gene expression trait stratified by
Tissue (Figure 2a) or Individual (Figure 2b).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get gene with the highest variation across Tissues</span></span>
<span><span class="co"># create data.frame with expression of gene i and Tissue</span></span>
<span><span class="co">#       type for each sample</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">varPart</span><span class="op">$</span><span class="va">Tissue</span><span class="op">)</span></span>
<span><span class="va">GE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Expression <span class="op">=</span> <span class="va">geneExpr</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>, Tissue <span class="op">=</span> <span class="va">info</span><span class="op">$</span><span class="va">Tissue</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 2a</span></span>
<span><span class="co"># plot expression stratified by Tissue</span></span>
<span><span class="fu"><a href="../reference/plotStratify.html">plotStratify</a></span><span class="op">(</span><span class="va">Expression</span> <span class="op">~</span> <span class="va">Tissue</span>, <span class="va">GE</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">geneExpr</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="variancePartition_files/figure-html/plotStratify-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get gene with the highest variation across Individuals</span></span>
<span><span class="co"># create data.frame with expression of gene i and Tissue</span></span>
<span><span class="co">#       type for each sample</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">varPart</span><span class="op">$</span><span class="va">Individual</span><span class="op">)</span></span>
<span><span class="va">GE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Expression <span class="op">=</span> <span class="va">geneExpr</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>,</span>
<span>  Individual <span class="op">=</span> <span class="va">info</span><span class="op">$</span><span class="va">Individual</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 2b</span></span>
<span><span class="co"># plot expression stratified by Tissue</span></span>
<span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Individual:"</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">varPart</span><span class="op">$</span><span class="va">Individual</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span>, <span class="st">"%"</span><span class="op">)</span></span>
<span><span class="va">main</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">geneExpr</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/plotStratify.html">plotStratify</a></span><span class="op">(</span><span class="va">Expression</span> <span class="op">~</span> <span class="va">Individual</span>, <span class="va">GE</span>,</span>
<span>  colorBy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  text <span class="op">=</span> <span class="va">label</span>, main <span class="op">=</span> <span class="va">main</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="variancePartition_files/figure-html/plotStratify-2.png" width="384" style="display: block; margin: auto;"></p>
<p>For gene141, variation across tissues explains 52.9% of variance in
gene expression. For gene43, variation across Individuals explains 91.4%
of variance in gene expression.</p>
</div>
<div class="section level4">
<h4 id="intuition-about-the-backend">Intuition about the backend<a class="anchor" aria-label="anchor" href="#intuition-about-the-backend"></a>
</h4>
<p>At the heart of <code>variancePartition</code>, a regression model is
fit for each gene separately and summary statistics are extracted and
reported to the user for visualization and downstream analysis. For a
single model fit, <code><a href="../reference/calcVarPart-method.html">calcVarPart()</a></code> computes the fraction of
variance explained by each variable. <code><a href="../reference/calcVarPart-method.html">calcVarPart()</a></code> is
defined by this package, and computes these statistics from either a
fixed effects model fit with <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> or a linear mixed model
fit with <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer()</a></code>.
<code><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel()</a></code> loops over each gene, fits the
regression model and returns the variance fractions reported by
<code><a href="../reference/calcVarPart-method.html">calcVarPart()</a></code>.</p>
<p>Fitting the regression model and extracting variance statistics can
also be done directly:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/lme4/lme4/" class="external-link">"lme4"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit regression model for the first gene</span></span>
<span><span class="va">form_test</span> <span class="op">&lt;-</span> <span class="va">geneExpr</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">~</span> <span class="va">Age</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Individual</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Tissue</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">form_test</span>, <span class="va">info</span>, REML <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract variance statistics</span></span>
<span><span class="fu"><a href="../reference/calcVarPart-method.html">calcVarPart</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Individual       Tissue          Age    Residuals </span></span>
<span><span class="co">## 8.903140e-01 2.468013e-02 4.354738e-05 8.496235e-02</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="interpretation">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation"></a>
</h3>
<p><code>variancePartition</code> fits a linear (mixed) model that
jointly considers the contribution of all specified variables on the
expression of each gene. It uses a multiple regression model so that the
effect of each variable is assessed while jointly accounting for all
others. <a href="https://www.r-bloggers.com/2011/03/anova-%E2%80%93-type-iiiiii-ss-explained/" class="external-link">Standard
ANOVA</a> implemented in R involves refitting the model while dropping
terms, but is aimed at hypothesis testing. <code><a href="../reference/calcVarPart-method.html">calcVarPart()</a></code> is
aimed at estimating variance fractions. It uses a single fit of the
linear (mixed) model and evaluates the sum of squares of each term and
the sum of squares of the total model fit. However, we note that like
any multiple regression model, high correlation bewtween fixed or random
effect variables (see <a href="#assess-correlation-between-all-pairs-of-variables">Assess
correlation between all pairs of variables</a>) can produce unstable
estimates and it can be challanging to identify which variable is
responsible for the expression variation.</p>
<p>The results of <code>variancePartition</code> give insight into the
expression data at multiple levels. Moreover, a single statistic often
has multiple equivalent interpretations while only one is relevant to
the biological question. Analysis of the example data in Figure 1 gives
some strong interpretations.</p>
<p>Considering the median across all genes,</p>
<ol style="list-style-type: decimal">
<li>variation across individuals explains a median of 81.5% of the
variation in expression, after correcting for tissue, batch and age</li>
<li>variation across tissues explains a median of 8.2% of the variation
in expression, after correcting for other the variables</li>
<li>variation across batches is negligible after correcting for
variation due to other variables</li>
<li>the effect of age is negligible after correcting for other
variables</li>
<li>correcting for individual, tissue, batch and age leaves a median of
9.3% of the total variance in expression.</li>
</ol>
<p>These statistics also have a natural interpretation in terms of the
intra-class correlation (ICC), the correlation between observations made
from samples in the same group.</p>
<p>Considering the median across across all genes and all
experiments,</p>
<ol style="list-style-type: decimal">
<li>the ICC for <u>individual</u> is 81.5%.</li>
<li>the ICC for <u>tissue</u> is 8.2%.</li>
<li>two randomly selected gene measurements from same <u>individual</u>,
but regardless of <u>tissue</u>, <u>batch</u> or <u>age</u>, have a
correlation of 81.5%.</li>
<li>two randomly selected gene measurements from same <u>tissue</u>, but
regardless of <u>individual</u>, <u>batch</u> or <u>age</u>, have a
correlation of 8.2%.</li>
<li>two randomly selected gene measurements from the same
<u>individual</u> <em>and</em> same <u>tissue</u>, but regardless of
<u>batch</u> and <u>age</u>, have an correlation of 81.5% + 8.2% =
89.7%.</li>
</ol>
<p>Note that that the ICC here is interpreted as the ICC after
correcting for all other variables in the model.</p>
<p>These conclusions are based on the genome-wide median across all
genes, but the same type of statements can be made at the gene-level.
Moreover, care must be taken in the interpretation of nested variables.
For example, <code>Age</code> is nested within <code>Individual</code>
since the multiple samples from each individual are taken at the same
age. Thus the effect of <code>Age</code> removes some variation from
being explained by <code>Individual</code>. This often arises when
considering variation across individuals and across sexes: any cross-sex
variation is a component of the cross-individual variation. So the total
variation across individuals is the sum of the fraction of variance
explained by <code>Sex</code> and <code>Individual</code>. This
nesting/summing of effects is common for variables that are properties
of the individual rather than the sample. For example, sex and ethnicity
are always properties of the individual. Variables like age and disease
state can be properties of the individual, but could also vary in
time-course or longitudinal experiments. The the interpretation depends
on the experimental design.</p>
<p>The real power of <code>variancePartition</code> is to identify
specific genes that follow or deviate from the genome-wide trend. The
gene-level statistics can be used to identify a subset of genes that are
enriched for specific biological functions. For example, we can ask if
the 500 genes with the highest variation in expression across tissues
(i.e. the long tail for tissue in Figure 1a) are enriched for genes
known to have high tissue-specificity.</p>
<div class="section level4">
<h4 id="should-a-variable-be-modeled-as-fixed-or-random-effect">Should a variable be modeled as fixed or random effect?<a class="anchor" aria-label="anchor" href="#should-a-variable-be-modeled-as-fixed-or-random-effect"></a>
</h4>
<p>Categorical variables should (almost) always be modeled as a random
effect. The difference between modeling a categorical variable as a
fixed versus random effect is minimal when the sample size is large
compared to the number of categories (i.e. levels). So variables like
disease status, sex or time point will not be sensitive to modeling as a
fixed versus random effect. However, variables with many categories like
<code>Individual</code> <em>must</em> be modeled as a random effect in
order to obtain statistically valid results. So to be on the safe side,
categorical variable should be modeled as a random effect.</p>
<p>% R and <code>variancePartition</code> handle catagorical variables
stored as a very naturally. If categorical variables are stored as an or
, they must be converted to a before being used with
<code>variancePartition</code></p>
<p><code>variancePartition</code> fits two types of models:</p>
<ol style="list-style-type: decimal">
<li><p>linear mixed model where <u>all</u> categorical variables are
modeled as random effects and all continuous variables are fixed
effects. The function <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer()</a></code> is used to fit this
model.</p></li>
<li><p>fixed effected model, where all variables are modeled as fixed
effects. The function <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> is used to fit this
model.</p></li>
</ol>
</div>
<div class="section level4">
<h4 id="which-variables-should-be-included">Which variables should be included?<a class="anchor" aria-label="anchor" href="#which-variables-should-be-included"></a>
</h4>
<p>In my experience, it is useful to include all variables in the first
analysis and then drop variables that have minimal effect. However, like
all multiple regression methods, <code>variancePartition</code> will
divide the contribution over multiple variables that are strongly
correlated. So, for example, including both sex and height in the model
will show sex having a smaller contribution to variation gene expression
than if height were omitted, since there variables are strongly
correlated. This is a simple example, but should give some intuition
about a common issue that arises in analyses with
<code>variancePartition</code>.</p>
<p><code>variancePartition</code> can naturally assess the contribution
of both individual and sex in a dataset. As expected, genes for which
sex explains a large fraction of variation are located on chrX and chrY.
If the goal is to interpret the impact of sex, then there is no issue.
But recall the issue with correlated variables and note that individual
is correlated with sex, because each individual is only one sex
regardless of how many samples are taken from a individual. It follows
that including sex in the model reduces the <u>apparent</u> contribution
of individual to gene expression. In other words, the ICC for individual
will be different if sex is included in the model.</p>
<p>In general, including variables in the model that do not vary within
individual will reduce the apparent contribution of individual as
estimated by <code>variancePartition</code>. For example, sex and
ethnicity never vary between multiple samples from the same individual
and will always reduce the apparent contribution of individual. However,
disease state and age may or may not vary depending on the study
design.</p>
<p>In biological datasets technical variability (i.e. batch effects) can
often reduce the apparent biological signal. In RNA-seq analysis, it is
common for the the impact of this technical variability to be removed
before downstream analysis. Instead of including these batch variable in
the <code>variancePartition</code> analysis, it is simple to complete
the expression residuals with the batch effects removed and then feeds
these residuals to <code>variancePartition</code>. This will increase
the fraction of variation explained by biological variables since
technical variability is reduced.</p>
<div class="section level5">
<h5 id="assess-correlation-between-all-pairs-of-variables">Assess correlation between all pairs of variables<a class="anchor" aria-label="anchor" href="#assess-correlation-between-all-pairs-of-variables"></a>
</h5>
<p>Evaluating the correlation between variables in a important part in
interpreting variancePartition results. When comparing two continuous
variables, Pearson correlation is widely used. But variancePartition
includes categorical variables in the model as well. In order to
accommodate the correlation between a continuous and a categorical
variable, or two categorical variables we used canonical correlation
analysis.</p>
<p>Canonical Correlation Analysis (CCA) is similar to correlation
between two vectors, except that CCA can accommodate matricies as well.
For a pair of variables, <code><a href="../reference/canCorPairs.html">canCorPairs()</a></code> assesses the degree
to which they co-vary and contain the same information. Variables in the
formula can be a continuous variable or a discrete variable expanded to
a matrix (which is done in the backend of a regression model). For a
pair of variables, <code><a href="../reference/canCorPairs.html">canCorPairs()</a></code> uses CCA to compute the
correlation between these variables and returns the pairwise correlation
matrix.</p>
<p>Statistically, let <code>rho</code> be the array of correlation
values returned by the standard R function cancor to compute CCA.
<code><a href="../reference/canCorPairs.html">canCorPairs()</a></code> returns <code>rho / sum(rho)</code> which is
the fraction of the maximum possible correlation. Note that CCA returns
correlations values between 0 and 1</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">Individual</span> <span class="op">+</span> <span class="va">Tissue</span> <span class="op">+</span> <span class="va">Batch</span> <span class="op">+</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Height</span></span>
<span></span>
<span><span class="co"># Compute Canonical Correlation Analysis (CCA)</span></span>
<span><span class="co"># between all pairs of variables</span></span>
<span><span class="co"># returns absolute correlation value</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/canCorPairs.html">canCorPairs</a></span><span class="op">(</span><span class="va">form</span>, <span class="va">info</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot correlation matrix</span></span>
<span><span class="co"># between all pairs of variables</span></span>
<span><span class="fu"><a href="../reference/plotCorrMatrix.html">plotCorrMatrix</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span></span></code></pre></div>
<p><img src="variancePartition_files/figure-html/canCorPairs-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="advanced-analysis">Advanced analysis<a class="anchor" aria-label="anchor" href="#advanced-analysis"></a>
</h3>
<div class="section level4">
<h4 id="extracting-additional-information-from-model-fits">Extracting additional information from model fits<a class="anchor" aria-label="anchor" href="#extracting-additional-information-from-model-fits"></a>
</h4>
<p>Advanced users may want to perform the model fit and extract results
in separate steps in order to examine the fit of the model for each
gene. Thus the work of can be divided into two steps: 1) fit the
regression model, and 2) extracting variance statistics.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">Age</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Individual</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Tissue</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Batch</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit model</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitVarPartModel-method.html">fitVarPartModel</a></span><span class="op">(</span><span class="va">geneExpr</span>, <span class="va">form</span>, <span class="va">info</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract results</span></span>
<span><span class="va">varPart</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extractVarPart.html">extractVarPart</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<p>Note that storing the model fits can use a lot of memory (~10Gb with
20K genes and 1000 experiments). I do not recommend unless you have a
specific need for storing the entire model fit.</p>
<p>Instead, <code><a href="../reference/fitVarPartModel-method.html">fitVarPartModel()</a></code> can extract any desired
information using any function that accepts the model fit from
<code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> or <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer()</a></code>. The results are stored in a
<code>list</code> and can be used for downstream analysis.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit model and run summary() function on each model fit</span></span>
<span><span class="va">vpSummaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitVarPartModel-method.html">fitVarPartModel</a></span><span class="op">(</span><span class="va">geneExpr</span>, <span class="va">form</span>, <span class="va">info</span>, fxn <span class="op">=</span> <span class="va">summary</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show results of summary() for the first gene</span></span>
<span><span class="va">vpSummaries</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Linear mixed model fit by maximum likelihood  ['lmerMod']</span></span>
<span><span class="co">## Formula: y.local ~ Age + (1 | Individual) + (1 | Tissue) + (1 | Batch)</span></span>
<span><span class="co">##    Data: data</span></span>
<span><span class="co">## Weights: data$w.local</span></span>
<span><span class="co">## Control: control</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##       AIC       BIC    logLik -2*log(L)  df.resid </span></span>
<span><span class="co">##     397.2     412.8    -192.6     385.2        94 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Scaled residuals: </span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -2.05797 -0.58651  0.01466  0.66030  1.97077 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##  Groups     Name        Variance Std.Dev.</span></span>
<span><span class="co">##  Individual (Intercept) 10.82274 3.28979 </span></span>
<span><span class="co">##  Batch      (Intercept)  0.00192 0.04382 </span></span>
<span><span class="co">##  Tissue     (Intercept)  0.30010 0.54781 </span></span>
<span><span class="co">##  Residual                1.02997 1.01488 </span></span>
<span><span class="co">## Number of obs: 100, groups:  Individual, 25; Batch, 4; Tissue, 3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##               Estimate Std. Error t value</span></span>
<span><span class="co">## (Intercept) -10.602426   1.094925  -9.683</span></span>
<span><span class="co">## Age           0.003183   0.016103   0.198</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Correlation of Fixed Effects:</span></span>
<span><span class="co">##     (Intr)</span></span>
<span><span class="co">## Age -0.739</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="removing-batch-effects-before-fitting-model">Removing batch effects before fitting model<a class="anchor" aria-label="anchor" href="#removing-batch-effects-before-fitting-model"></a>
</h4>
<p>Gene expression studies often have substantial batch effects, and
<code>variancePartition</code> can be used to understand the magnitude
of the effects. However, we often want to focus on biological variables
(i.e. individual, tissue, disease, sex) after removing the effect of
technical variables. Depending on the size of the batch effect, I have
found it useful to correct for the batch effect first and then perform a
<code>variancePartition</code> analysis afterward. Subtracting this
batch effect can reduce the total variation in the data, so that the
contribution of other variables become clearer.</p>
<p>Standard analysis:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Tissue</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Individual</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Batch</span><span class="op">)</span> <span class="op">+</span> <span class="va">Age</span></span>
<span><span class="va">varPart</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel</a></span><span class="op">(</span><span class="va">geneExpr</span>, <span class="va">form</span>, <span class="va">info</span><span class="op">)</span></span></code></pre></div>
<p>Analysis on residuals:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://bioinf.wehi.edu.au/limma/" class="external-link">"limma"</a></span><span class="op">)</span></span>
<span><span class="co"># subtract out effect of Batch</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html" class="external-link">lmFit</a></span><span class="op">(</span><span class="va">geneExpr</span>, <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">Batch</span>, <span class="va">info</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">geneExpr</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit model on residuals</span></span>
<span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Tissue</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Individual</span><span class="op">)</span> <span class="op">+</span> <span class="va">Age</span></span>
<span></span>
<span><span class="va">varPartResid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">form</span>, <span class="va">info</span><span class="op">)</span></span></code></pre></div>
<p>Remove batch effect with linear mixed model</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># subtract out effect of Batch with linear mixed model</span></span>
<span><span class="va">modelFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitVarPartModel-method.html">fitVarPartModel</a></span><span class="op">(</span><span class="va">geneExpr</span>, <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Batch</span><span class="op">)</span>, <span class="va">info</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">modelFit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit model on residuals</span></span>
<span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Tissue</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Individual</span><span class="op">)</span> <span class="op">+</span> <span class="va">Age</span></span>
<span></span>
<span><span class="va">varPartResid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">form</span>, <span class="va">info</span><span class="op">)</span></span></code></pre></div>
<p>If the two-step process requires too much memory, the residuals can
be computed more efficiently. Here, run the function inside the call to
<code><a href="../reference/fitVarPartModel-method.html">fitVarPartModel()</a></code> to avoid storing the large intermediate
results.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract residuals directly without storing intermediate results</span></span>
<span><span class="va">residList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitVarPartModel-method.html">fitVarPartModel</a></span><span class="op">(</span><span class="va">geneExpr</span>, <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Batch</span><span class="op">)</span>, <span class="va">info</span>,</span>
<span>  fxn <span class="op">=</span> <span class="va">residuals</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert list to matrix</span></span>
<span><span class="va">residMatrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">residList</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="variation-within-multiple-subsets-of-the-data">Variation within multiple subsets of the data<a class="anchor" aria-label="anchor" href="#variation-within-multiple-subsets-of-the-data"></a>
</h4>
<p>So far, we have focused on interpreting one variable at a time. But
the linear mixed model behind <code>variancePartition</code> is a very
powerful framework for analyzing variation at multiple levels. We can
easily extend the previous analysis of the contribution of individual
and tissue on variation in gene expression to examine the contribution
of individual <em>within</em> each tissue. This analysis is as easy as
specifying a new formula and rerunning <code>variancePartition</code>.
Note that is analysis will only work when there are replicates for at
least some individuals within each tissue in order to assess
cross-individual variance with in a tissue.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify formula to model within/between individual variance</span></span>
<span><span class="co"># separately for each tissue</span></span>
<span><span class="co"># Note that including +0 ensures each tissue is modeled explicitly</span></span>
<span><span class="co"># Otherwise, the first tissue would be used as baseline</span></span>
<span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="op">(</span><span class="va">Tissue</span> <span class="op">+</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">Individual</span><span class="op">)</span> <span class="op">+</span> <span class="va">Age</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Tissue</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Batch</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit model and extract variance percents</span></span>
<span><span class="va">varPart</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel</a></span><span class="op">(</span><span class="va">geneExpr</span>, <span class="va">form</span>, <span class="va">info</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># violin plot</span></span>
<span><span class="fu"><a href="../reference/plotVarPart-method.html">plotVarPart</a></span><span class="op">(</span><span class="fu"><a href="../reference/sortCols-method.html">sortCols</a></span><span class="op">(</span><span class="va">varPart</span><span class="op">)</span>, label.angle <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></span></code></pre></div>
<p><img src="variancePartition_files/figure-html/withinTissue-1.png" width="384" style="display: block; margin: auto;"></p>
<p>This analysis corresponds to a varying coefficient model, where the
correlation between individuals varies for each tissue ]. Since the
variation across individuals is modeled within each tissue, the total
variation explained does not sum to 1 as it does for standard
application of <code>variancePartition</code>. So interpretation as
intra-class does not strictly apply and use of
<code><a href="../reference/plotPercentBars-method.html">plotPercentBars()</a></code> is no longer applicable. Yet the
variables in the study design are still ranked in terms of their
genome-wide contribution to expression variation, and results can still
be analyzed at the gene level. See <a href="#variation-with-multiple-subsets-of-the-data">Variation with
multiple subsets of the data</a> for statistical details.</p>
</div>
<div class="section level4">
<h4 id="detecting-problems-caused-by-collinearity-of-variables">Detecting problems caused by collinearity of variables<a class="anchor" aria-label="anchor" href="#detecting-problems-caused-by-collinearity-of-variables"></a>
</h4>
<p>Including variables that are highly correlated can produce misleading
results and overestimate the contribution of variables modeled as fixed
effects. This is usually not an issue, but can arise when statistically
redundant variables are included in the model. In this case, the model
is <code>"degenerate"</code> or <code>"computationally singular"</code>
and parameter estimates from this model are not meaningful. Dropping one
or more of the covariates will fix this problem.</p>
<p>A check of collinearity is built into <code><a href="../reference/fitVarPartModel-method.html">fitVarPartModel()</a></code>
and <code><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel()</a></code>, so the user will be warned if
this is an issue.</p>
<p>Alternatively, the user can use the <code><a href="../reference/colinearityScore.html">colinearityScore()</a></code>
function to evaluate whether this is an issue for a single model
fit:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Individual</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Tissue</span><span class="op">)</span> <span class="op">+</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Height</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitVarPartModel-method.html">fitVarPartModel</a></span><span class="op">(</span><span class="va">geneExpr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="op">]</span>, <span class="va">form</span>, <span class="va">info</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># evaluate the collinearity score on the first model fit</span></span>
<span><span class="co"># this reports the correlation matrix between coefficient estimates</span></span>
<span><span class="co"># for fixed effects</span></span>
<span><span class="co"># the collinearity score is the maximum absolute correlation value</span></span>
<span><span class="co"># If the collinearity score &gt; .99 then the variance partition</span></span>
<span><span class="co"># estimates may be problematic</span></span>
<span><span class="co"># In that case, a least one variable should be omitted</span></span>
<span><span class="fu"><a href="../reference/colinearityScore.html">colinearityScore</a></span><span class="op">(</span><span class="va">res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.7774082</span></span>
<span><span class="co">## attr(,"vcor")</span></span>
<span><span class="co">##             (Intercept)         Age      Height</span></span>
<span><span class="co">## (Intercept)   1.0000000 -0.41907978 -0.77740819</span></span>
<span><span class="co">## Age          -0.4190798  1.00000000 -0.05748224</span></span>
<span><span class="co">## Height       -0.7774082 -0.05748224  1.00000000</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="including-weights-computed-separately">Including weights computed separately<a class="anchor" aria-label="anchor" href="#including-weights-computed-separately"></a>
</h4>
<p><code>variancePartition</code> automatically used precision weights
computed by <code><a href="https://rdrr.io/pkg/limma/man/voom.html" class="external-link">limma::voom()</a></code>, but the user can also specify
custom weights using the <code>weightsMatrix</code> argument.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Individual</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Tissue</span><span class="op">)</span> <span class="op">+</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Height</span></span>
<span></span>
<span><span class="co"># Specify custom weights</span></span>
<span><span class="co"># In this example the weights are simulated from a</span></span>
<span><span class="co"># uniform distribution and are not meaningful.</span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">geneExpr</span><span class="op">)</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">geneExpr</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify custom weights</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel</a></span><span class="op">(</span><span class="va">geneExpr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="op">]</span>, <span class="va">form</span>, <span class="va">info</span>,</span>
<span>  weightsMatrix <span class="op">=</span> <span class="va">weights</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In addition, setting the <code>useWeights=FALSE</code> will suppress
usage of the weights in all cases, i.e. when the weights are specified
manually or implicitly with the results of
<code><a href="https://rdrr.io/pkg/limma/man/voom.html" class="external-link">limma::voom()</a></code>.</p>
</div>
<div class="section level4">
<h4 id="including-interaction-terms">Including interaction terms<a class="anchor" aria-label="anchor" href="#including-interaction-terms"></a>
</h4>
<p>Typical analysis assumes that the effect of each variable on gene
expression does not depend on other variables in the model. Sometimes
this assumption is too strict, and we want to model an interaction
effect whereby the effect of <code>Batch</code> depends on
<code>Tissue</code>. This can be done easly by specifying an interaction
term, <code>(1|Batch:Tissue)</code>. Since <code>Batch</code> has 4
categories and <code>Tissue</code> has 3, this interaction term
implicity models a new <code>3*4 = 12</code> category variable in the
analysis. This new interaction term will absorb some of the variance
from the <code>Batch</code> and <code>Tissue</code> term, so an
interaction model should always include the two constituent
variables.</p>
<p>Here we fit an interaction model, but we observe that interaction
between <code>Batch</code> and <code>Tissue</code> does not explain much
expression variation.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Individual</span><span class="op">)</span> <span class="op">+</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Height</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Tissue</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Batch</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Batch</span><span class="op">:</span><span class="va">Tissue</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit model</span></span>
<span><span class="va">vpInteraction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel</a></span><span class="op">(</span><span class="va">geneExpr</span>, <span class="va">form</span>, <span class="va">info</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotVarPart-method.html">plotVarPart</a></span><span class="op">(</span><span class="fu"><a href="../reference/sortCols-method.html">sortCols</a></span><span class="op">(</span><span class="va">vpInteraction</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="variancePartition_files/figure-html/vpInteraction-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="application-to-expression-data">Application to expression data<a class="anchor" aria-label="anchor" href="#application-to-expression-data"></a>
</h2>
<p><code>variancePartition</code> works with gene expression data that
has already been processed and normalized as for differential expression
analysis.</p>
<div class="section level3">
<h3 id="gene-level-counts">Gene-level counts<a class="anchor" aria-label="anchor" href="#gene-level-counts"></a>
</h3>
<p><code>featureCounts</code> <span class="citation">(Liao et al.
2014)</span> and <code>HTSeq</code> <span class="citation">(Anders et
al. 2015)</span> report the number of reads mapping to each gene (or
exon). These results are easily read into R. <code><a href="https://rdrr.io/pkg/limma/man/voom.html" class="external-link">limma::voom()</a></code>
and <code>DESeq2</code> are widely used for differential expression
analysis of gene- and exon-level counts and can be used to process data
before analysis with <code>variancePartition</code>. This section
addresses processing and normalization of gene-level counts, but the
analysis is the same for exon-level counts.</p>
<div class="section level4">
<h4 id="limmavoom">
<code>limma::voom()</code><a class="anchor" aria-label="anchor" href="#limmavoom"></a>
</h4>
<p>Read RNA-seq counts into R, normalize for library size within and
between experiments with TMM <span class="citation">(Robinson and
Oshlack 2010)</span>, estimate precision weights with
<code><a href="https://rdrr.io/pkg/limma/man/voom.html" class="external-link">limma::voom()</a></code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://bioinf.wehi.edu.au/limma/" class="external-link">"limma"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://bioinf.wehi.edu.au/edgeR/" class="external-link">"edgeR"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># identify genes that pass expression cutoff</span></span>
<span><span class="va">isexpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/cpm.html" class="external-link">cpm</a></span><span class="op">(</span><span class="va">geneCounts</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">geneCounts</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create data structure with only expressed genes</span></span>
<span><span class="va">gExpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/DGEList.html" class="external-link">DGEList</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="va">geneCounts</span><span class="op">[</span><span class="va">isexpr</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform TMM normalization</span></span>
<span><span class="va">gExpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/calcNormFactors.html" class="external-link">calcNormFactors</a></span><span class="op">(</span><span class="va">gExpr</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify variables to be included in the voom() estimates of</span></span>
<span><span class="co"># uncertainty.</span></span>
<span><span class="co"># Recommend including variables with a small number of categories</span></span>
<span><span class="co"># that explain a substantial amount of variation</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">Batch</span>, <span class="va">info</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate precision weights for each gene and sample</span></span>
<span><span class="co"># This models uncertainty in expression measurements</span></span>
<span><span class="va">vobjGenes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/voom.html" class="external-link">voom</a></span><span class="op">(</span><span class="va">gExpr</span>, <span class="va">design</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define formula</span></span>
<span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Individual</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Tissue</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Batch</span><span class="op">)</span> <span class="op">+</span> <span class="va">Age</span></span>
<span></span>
<span><span class="co"># variancePartition seamlessly deals with the result of voom()</span></span>
<span><span class="co"># by default, it seamlessly models the precision weights</span></span>
<span><span class="co"># This can be turned off with useWeights=FALSE</span></span>
<span><span class="va">varPart</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel</a></span><span class="op">(</span><span class="va">vobjGenes</span>, <span class="va">form</span>, <span class="va">info</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="deseq2">
<code>DESeq2</code><a class="anchor" aria-label="anchor" href="#deseq2"></a>
</h4>
<p>Process and normalize the gene-level counts before running
<code>variancePartition</code> analysis.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/thelovelab/DESeq2" class="external-link">"DESeq2"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create DESeq2 object from gene-level counts and metadata</span></span>
<span><span class="va">dds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeqDataSet.html" class="external-link">DESeqDataSetFromMatrix</a></span><span class="op">(</span></span>
<span>  countData <span class="op">=</span> <span class="va">geneCounts</span>,</span>
<span>  colData <span class="op">=</span> <span class="va">info</span>,</span>
<span>  design <span class="op">=</span> <span class="op">~</span><span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate library size correction scaling factors</span></span>
<span><span class="va">dds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/dge.html" class="external-link">estimateSizeFactors</a></span><span class="op">(</span><span class="va">dds</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># identify genes that pass expression cutoff</span></span>
<span><span class="va">isexpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/fpm.html" class="external-link">fpm</a></span><span class="op">(</span><span class="va">dds</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">dds</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compute log2 Fragments Per Million</span></span>
<span><span class="co"># Alternatively, fpkm(), vst() or rlog() could be used</span></span>
<span><span class="va">quantLog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/fpm.html" class="external-link">fpm</a></span><span class="op">(</span><span class="va">dds</span><span class="op">)</span><span class="op">[</span><span class="va">isexpr</span>, <span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define formula</span></span>
<span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Individual</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Tissue</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Batch</span><span class="op">)</span> <span class="op">+</span> <span class="va">Age</span></span>
<span></span>
<span><span class="co"># Run variancePartition analysis</span></span>
<span><span class="va">varPart</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel</a></span><span class="op">(</span><span class="va">quantLog</span>, <span class="va">form</span>, <span class="va">info</span><span class="op">)</span></span></code></pre></div>
<p>Note that <code>DESeq2</code> does not compute precision weights like
<code><a href="https://rdrr.io/pkg/limma/man/voom.html" class="external-link">limma::voom()</a></code>, so they are not used in this version of the
analysis.</p>
</div>
<div class="section level4">
<h4 id="isoform-quantification">Isoform quantification<a class="anchor" aria-label="anchor" href="#isoform-quantification"></a>
</h4>
<p>Other software performs isoform-level quantification using reads that
map to multiple transcripts. These include <code>kallisto</code> <span class="citation">(Bray et al. 2016)</span>, <code>sailfish</code> <span class="citation">(Patro et al. 2014)</span>, <code>salmon</code> <span class="citation">Patro et al. (2015)</span>, <code>RSEM</code> <span class="citation">(Li and Dewey 2011)</span>and <code>cufflinks</code>
<span class="citation">(Trapnell et al. 2010.)</span></p>
<div class="section level5">
<h5 id="tximport">
<code>tximport</code><a class="anchor" aria-label="anchor" href="#tximport"></a>
</h5>
<p>Quantifications from <code>kallisto</code>, <code>salmon</code>,
<code>sailfish</code> and <code>RSEM</code> can be read into R and
processed with the Bioconductor package <code>tximport</code>. The gene-
or transcript-level quantifications can be used directly in
<code>variancePartition</code>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"tximportData"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"tximport"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://readr.tidyverse.org" class="external-link">"readr"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get data from folder where tximportData is installed</span></span>
<span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"tximportData"</span><span class="op">)</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"samples.txt"</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"kallisto"</span>, <span class="va">samples</span><span class="op">$</span><span class="va">run</span>, <span class="st">"abundance.tsv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sample"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tx2gene</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"tx2gene.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reads results from kallisto</span></span>
<span><span class="va">txi</span> <span class="op">&lt;-</span> <span class="fu">tximport</span><span class="op">(</span><span class="va">files</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"kallisto"</span>, tx2gene <span class="op">=</span> <span class="va">tx2gene</span>,</span>
<span>  countsFromAbundance <span class="op">=</span> <span class="st">"lengthScaledTPM"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define metadata (usually read from external source)</span></span>
<span><span class="va">info_tximport</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"sample%d"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>,</span>
<span>  Disease <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"case"</span>, <span class="st">"control"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract counts from kallisto</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/DGEList.html" class="external-link">DGEList</a></span><span class="op">(</span><span class="va">txi</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compute library size normalization</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/calcNormFactors.html" class="external-link">calcNormFactors</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># apply voom to estimate precision weights</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">Disease</span>, data <span class="op">=</span> <span class="va">info_tximport</span><span class="op">)</span></span>
<span><span class="va">vobj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/voom.html" class="external-link">voom</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">design</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define formula</span></span>
<span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Disease</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run variancePartition analysis (on only 10 genes)</span></span>
<span><span class="va">varPart_tx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel</a></span><span class="op">(</span></span>
<span>  <span class="va">vobj</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span>, <span class="va">form</span>,</span>
<span>  <span class="va">info_tximport</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Code to process results from <code>sailfish</code>,
<code>salmon</code>, <code>RSEM</code> is very similar.</p>
<p>See <a href="http://bioconductor.org/packages/release/bioc/vignettes/tximport/inst/doc/tximport.html" class="external-link">tutorial</a>
for more details.</p>
</div>
</div>
<div class="section level4">
<h4 id="ballgown">
<code>ballgown</code><a class="anchor" aria-label="anchor" href="#ballgown"></a>
</h4>
<p>Quantifications from Cufflinks/Tablemaker and RSEM can be processed
and read into R with the Bioconductor package <code>ballgown</code>.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"ballgown"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get data from folder where ballgown is installed</span></span>
<span><span class="va">data_directory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"ballgown"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load results of Cufflinks/Tablemaker</span></span>
<span><span class="va">bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ballgown/man/ballgown-constructor.html" class="external-link">ballgown</a></span><span class="op">(</span></span>
<span>  dataDir <span class="op">=</span> <span class="va">data_directory</span>, samplePattern <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>  meas <span class="op">=</span> <span class="st">"all"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract gene-level FPKM quantification</span></span>
<span><span class="co"># Expression can be convert to log2-scale if desired</span></span>
<span><span class="va">gene_expression</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ballgown/man/gexpr.html" class="external-link">gexpr</a></span><span class="op">(</span><span class="va">bg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract transcript-level FPKM quantification</span></span>
<span><span class="co"># Expression can be convert to log2-scale if desired</span></span>
<span><span class="va">transcript_fpkm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ballgown/man/texpr.html" class="external-link">texpr</a></span><span class="op">(</span><span class="va">bg</span>, <span class="st">"FPKM"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define metadata (usually read from external source)</span></span>
<span><span class="va">info_ballgown</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"sample%02d"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span>,</span>
<span>  Batch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  Disease <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"case"</span>, <span class="st">"control"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define formula</span></span>
<span><span class="va">form</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Batch</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Disease</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run variancePartition analysis</span></span>
<span><span class="co"># Gene-level analysis</span></span>
<span><span class="va">varPart_gene</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel</a></span><span class="op">(</span></span>
<span>  <span class="va">gene_expression</span>, <span class="va">form</span>,</span>
<span>  <span class="va">info_ballgown</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in filterInputData(exprObj, formula, data, useWeights = useWeights): Sample names of responses (i.e. columns of exprObj) do not match</span></span>
<span><span class="co">## sample names of metadata (i.e. rows of data).  Recommend consistent</span></span>
<span><span class="co">## names so downstream results are labeled consistently.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in .fitExtractVarPartModel(exprObj, formula, data, REML = REML, : Model failed for 1 responses.</span></span>
<span><span class="co">##   See errors with attr(., 'errors')</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transcript-level analysis</span></span>
<span><span class="va">varPart_transcript</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel</a></span><span class="op">(</span></span>
<span>  <span class="va">transcript_fpkm</span>, <span class="va">form</span>,</span>
<span>  <span class="va">info_ballgown</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in filterInputData(exprObj, formula, data, useWeights = useWeights): Sample names of responses (i.e. columns of exprObj) do not match</span></span>
<span><span class="co">## sample names of metadata (i.e. rows of data).  Recommend consistent</span></span>
<span><span class="co">## names so downstream results are labeled consistently.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in .fitExtractVarPartModel(exprObj, formula, data, REML = REML, : Model failed for 2 responses.</span></span>
<span><span class="co">##   See errors with attr(., 'errors')</span></span></code></pre>
<p>Note that <code>ballgownrsem</code> can be used for a similar
analysis of <code>RSEM</code> results.</p>
<p>See <a href="http://bioconductor.org/packages/release/bioc/vignettes/ballgown/inst/doc/ballgown.html" class="external-link">tutorial</a>
for more details.</p>
</div>
</div>
<div class="section level3">
<h3 id="compare-with-other-methods">Compare with other methods<a class="anchor" aria-label="anchor" href="#compare-with-other-methods"></a>
</h3>
<p>Characterizing drivers of variation in gene expression data has
typically relied on principal components analysis (PCA) and hierarchical
clustering. Here I apply these methods to two simulated datasets to
demonstrate the additional insight from an analysis with
<code>variancePartition</code>. Each simulated dataset comprises 60
experiments from 10 individuals and 3 tissues with 2 biological
replicates. In the first dataset, tissue is the major driver of
variation in gene expression(Figure @ref(fig:siteDominant)). In the
second dataset, individual is the major driver of variation in gene
expression (Figures @ref(fig:IndivDominant)).</p>
<p>Analysis of simulated data illustrates that PCA identifies the major
driver of variation when tissue is dominant and there are only 3
categories. But the results are less clear when individual is dominant
because there are now 10 categories. Meanwhile, hierarchical clustering
identifies the major driver of variation in both cases, but does not
give insight into the second leading contributor.</p>
<p>Analysis with <code>variancePartition</code> has a number of
advantages over these standard methods:</p>
<ol style="list-style-type: decimal">
<li>
<p><code>variancePartition</code> provides a natural interpretation
of multiple variables</p>
<ul>
<li>figures from PCA/hierarchical clustering allow easy interpretation
of only one variable</li>
</ul>
</li>
<li>
<p><code>variancePartition</code> quantifies the contribution of
each variable</p>
<ul>
<li>PCA/hierarchical clustering give only a visual representation</li>
</ul>
</li>
<li>
<p><code>variancePartition</code> interprets contribution of each
variable to each gene individually for downstream analysis</p>
<ul>
<li>PCA/hierarchical clustering produces genome-wide summary and does
not allow gene-level interpretation</li>
</ul>
</li>
<li><p><code>variancePartition</code> can assess contribution of one
variable (i.e. Individual) separately in subset of the data defined by
another variable (i.e. Tissue)</p></li>
</ol>
<div class="section level4">
<h4 id="tissue-is-major-source-of-variation">Tissue is major source of variation<a class="anchor" aria-label="anchor" href="#tissue-is-major-source-of-variation"></a>
</h4>
<p><img src="variancePartition_files/figure-html/siteDominant-1.png" width="768" style="display: block; margin: auto;"><img src="variancePartition_files/figure-html/cowplot-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="individual-is-major-source-of-variation">Individual is major source of variation<a class="anchor" aria-label="anchor" href="#individual-is-major-source-of-variation"></a>
</h4>
<p><img src="variancePartition_files/figure-html/IndivDominant-1.png" width="768" style="display: block; margin: auto;"><img src="variancePartition_files/figure-html/cowplot2-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="statistical-details">Statistical details<a class="anchor" aria-label="anchor" href="#statistical-details"></a>
</h3>
<p>A <code>variancePartition</code> analysis evaluates the linear
(mixed) model <span class="math display">\begin{eqnarray}
  y &amp;=&amp; \sum_j X_j\beta_j + \sum_k Z_k \alpha_k + \varepsilon \\
  \alpha_k &amp;\sim&amp; \mathcal{N}(0, \sigma^2_{\alpha_k})\\
  \varepsilon &amp;\sim&amp; \mathcal{N}(0, \sigma^2_\varepsilon)
\end{eqnarray}</span> where <span class="math inline">y</span> is the
expression of a single gene across all samples, <span class="math inline">X_j</span> is the matrix of <span class="math inline">j^{th}</span> fixed effect with coefficients <span class="math inline">\beta_j</span>, <span class="math inline">Z_k</span>
is the matrix corresponding to the <span class="math inline">k^{th}</span> random effect with coefficients <span class="math inline">\alpha_k</span> drawn from a normal distribution
with variance <span class="math inline">\sigma^2_{\alpha_k}</span>. The
noise term, <span class="math inline">\varepsilon</span>, is drawn from
a normal distribution with variance <span class="math inline">\sigma^2_\varepsilon</span>. Parameters are
estimated with maximum likelihood, rather than REML, so that fixed
effect coefficients, <span class="math inline">\beta_j</span>, are
explicitly estimated.</p>
<p>I use the term “linear (mixed) model” here since
<code>variancePartition</code> works seamlessly when a fixed effects
model (i.e. linear model) is specified.</p>
<p>Variance terms for the fixed effects are computed using the <em>post
hoc</em> calculation<br><span class="math display">\begin{eqnarray}
\hat{\sigma}^2_{\beta_j} = \text{var}\left( X_j \hat{\beta}_j\right).
\end{eqnarray}</span> For a fixed effects model, this corresponds to the
sum of squares for each component of the model.</p>
<p>For a standard application of the linear mixed model, where the
effect of each variable is additive, the fraction of variance explained
by the <span class="math inline">j^{th}</span> fixed effect is <span class="math display">\begin{eqnarray}
\frac{\hat{\sigma}^2_{\beta_j}}{\sum_j \hat{\sigma}^2_{\beta_j} + \sum_k
\hat{\sigma}^2_{\alpha_k} + \hat{\sigma}^2_\varepsilon},
\end{eqnarray}</span> by the <span class="math inline">k^{th}</span>
random effect is <span class="math display">\begin{eqnarray}
\frac{\hat{\sigma}^2_{\alpha_k}}{\sum_j \hat{\sigma}^2_{\beta_j} +
\sum_k \hat{\sigma}^2_{\alpha_k} + \hat{\sigma}^2_\varepsilon},
\end{eqnarray}</span> and the residual variance is <span class="math display">\begin{eqnarray}
\frac{\hat{\sigma}^2_{\varepsilon}}{\sum_j \hat{\sigma}^2_{\beta_j} +
\sum_k \hat{\sigma}^2_{\alpha_k} + \hat{\sigma}^2_\varepsilon}.
\end{eqnarray}</span></p>
<div class="section level4">
<h4 id="implementation-in-r">Implementation in R<a class="anchor" aria-label="anchor" href="#implementation-in-r"></a>
</h4>
<p>An R formula is used to define the terms in the fixed and random
effects, and <code><a href="../reference/fitVarPartModel-method.html">fitVarPartModel()</a></code> fits the specified model for
each gene separately. If random effects are specified,
<code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer()</a></code> is used behind the scenes to fit the model,
while <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> is used if there are only fixed effects.
<code><a href="../reference/fitVarPartModel-method.html">fitVarPartModel()</a></code> returns a list of the model fits, and
returns the variance partition statistics for each model in the list.
<code><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel()</a></code> combines the actions of
<code><a href="../reference/fitVarPartModel-method.html">fitVarPartModel()</a></code> and into one function call.
<code><a href="../reference/calcVarPart-method.html">calcVarPart()</a></code> is called behind the scenes to compute
variance fractions for both fixed and mixed effects models, but the user
can also call this function directly on a model fit with
<code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> or <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer()</a></code>.</p>
</div>
<div class="section level4">
<h4 id="interpretation-of-percent-variance-explained">Interpretation of percent variance explained<a class="anchor" aria-label="anchor" href="#interpretation-of-percent-variance-explained"></a>
</h4>
<p>The percent variance explained can be interpreted as the intra-class
correlation (ICC) when a special case of Equation 1 is used. Consider
the simplest example of the <span class="math inline">i^{th}</span>
sample from the <span class="math inline">k^{th}</span> individual <span class="math display">\begin{eqnarray}
  y_{i,k} = \mu + Z \alpha_{i,k} + e_{i,k}
\end{eqnarray}</span> with only an intercept term, one random effect
corresponding to individual, and an error term. In this case ICC
corresponds to the correlation between two samples from the same
individual. This value is equal to the fraction of variance explained by
individual. For example, consider the correlation between samples from
the same individual: <span class="math display">\begin{eqnarray}
  ICC &amp;=&amp; cor( y_{1,k}, y_{2,k}) \\
      &amp;=&amp; cor( \mu + Z \alpha_{1,k}  + e_{1,k}, \mu + Z
\alpha_{2,k}  + e_{2,k}) \\
      &amp;=&amp; \frac{cov( \mu + Z \alpha_{1,k}  + e_{1,k}, \mu + Z
\alpha_{2,k}  + e_{2,k})}{ \sqrt{ var(\mu + Z \alpha_{1,k} + e_{1,k})
var( \mu + Z \alpha_{2,k} + e_{2,k})}}\\
      &amp;=&amp; \frac{cov(Z \alpha_{1,k}, Z
\alpha_{2,k})}{\sigma^2_\alpha + \sigma^2_\varepsilon} \\
      &amp;=&amp; \frac{\sigma^2_\alpha}{\sigma^2_\alpha +
\sigma^2_\varepsilon}
\end{eqnarray}</span> The correlation between samples from different
individuals is: <span class="math display">\begin{eqnarray}
  &amp;=&amp; cor( y_{1,1}, y_{1,2}) \\
      &amp;=&amp; cor( \mu + Z \alpha_{1,1} + e_{1,1}, \mu + Z
\alpha_{1,2}  + e_{1,2}) \\
      &amp;=&amp; \frac{cov(Z \alpha_{1,1}, Z
\alpha_{1,2})}{\sigma^2_\alpha + \sigma^2_\varepsilon} \\
      &amp;=&amp; \frac{0}{\sigma^2_\alpha + \sigma^2_\varepsilon} \\
      &amp;=&amp; 0
\end{eqnarray}</span> This interpretation in terms of fraction of
variation explained (FVE) naturally generalizes to multiple variance
components. Consider two sources of variation, individual and cell type
with variances <span class="math inline">\sigma^2_{id}</span> and <span class="math inline">\sigma^2_{cell},</span> respectively. Applying a
generalization of the the previous derivation, two samples are
correlated according to:</p>
<table class="table">
<colgroup>
<col width="18%">
<col width="14%">
<col width="13%">
<col width="26%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th>Individual</th>
<th>cell type</th>
<th>variance</th>
<th>Interpretation</th>
<th>Correlation value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>same</td>
<td>different</td>
<td><span class="math inline">\frac{\sigma^2_{id}}{\sigma^2_{id} +
\sigma^2_{cell} + \sigma^2_\varepsilon }</span></td>
<td>FVE by individual</td>
<td><span class="math inline">ICC_{individual}</span></td>
</tr>
<tr class="even">
<td>different</td>
<td>same</td>
<td><span class="math inline">\frac{\sigma^2_{cell}}{\sigma^2_{id} +
\sigma^2_{cell} + \sigma^2_\varepsilon }</span></td>
<td>FVE by cell type</td>
<td><span class="math inline">ICC_{cell}</span></td>
</tr>
<tr class="odd">
<td>same</td>
<td>same</td>
<td><span class="math inline">\frac{\sigma^2_{id} +
\sigma^2_{cell}}{\sigma^2_{id} + \sigma^2_{cell} + \sigma^2_\varepsilon
}</span></td>
<td>sum of FVE by individual &amp; cell type</td>
<td><span class="math inline">ICC_{individual,cell}</span></td>
</tr>
<tr class="even">
<td>different</td>
<td>different</td>
<td><span class="math inline">\frac{0}{\sigma^2_{id} + \sigma^2_{cell} +
\sigma^2_\varepsilon }</span></td>
<td>sample are independent</td>
<td></td>
</tr>
</tbody>
</table>
<p>Notice that the correlation between samples from the same individual
and same cell type corresponds to the sum of the fraction explained by
individual + fraction explained by cell type. This defines ICC for
individual and tissue, as well as the combined ICC and relates these
values to FVE.</p>
<p>In order to illustrate how this FVE and ICC relate to the correlation
between samples in multilevel datasets, consider a simple example of 5
samples from 2 individuals and 2 tissues:</p>
<table class="table">
<thead><tr class="header">
<th>Sample</th>
<th>Individual</th>
<th>Cell type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>a</td>
<td>1</td>
<td>T-Cell</td>
</tr>
<tr class="even">
<td>b</td>
<td>1</td>
<td>T-Cell</td>
</tr>
<tr class="odd">
<td>c</td>
<td>1</td>
<td>monocyte</td>
</tr>
<tr class="even">
<td>d</td>
<td>2</td>
<td>T-Cell</td>
</tr>
<tr class="odd">
<td>e</td>
<td>2</td>
<td>monocyte</td>
</tr>
</tbody>
</table>
<p>Modeling the separate effects of individual and tissue gives the
following covariance structure between samples when a linear mixed model
is used:</p>
<div class="math">
<p><span class="math display">
\begin{array}{ccc} &amp;
\\
cov(y)=\begin{array}{ccccc}
a \\
b \\
c\\
d\\
e\end{array}
&amp;
\left(
\begin{array}{ccccc}
\sigma^2_{id} + \sigma^2_{cell} + \sigma^2_\varepsilon &amp; &amp;
&amp;&amp;\\
\sigma^2_{id} + \sigma^2_{cell} &amp; \sigma^2_{id} + \sigma^2_{cell} +
\sigma^2_\varepsilon  &amp; &amp; &amp;\\
\sigma^2_{id}  &amp; \sigma^2_{id} &amp;\sigma^2_{id} + \sigma^2_{cell}
+ \sigma^2_\varepsilon  &amp; &amp;\\
\sigma^2_{cell} &amp; \sigma^2_{cell} &amp;0 &amp;\sigma^2_{id} +
\sigma^2_{cell} + \sigma^2_\varepsilon  &amp;\\
0 &amp; 0 &amp;\sigma^2_{cell} &amp; \sigma^2_{id} &amp;\sigma^2_{id} +
\sigma^2_{cell} + \sigma^2_\varepsilon \\
\end{array}
\right)\end{array}
</span></p>
</div>
<p>The covariance matrix is symmetric so that blank entries take the
value on the opposite side of the diagonal. The covariance can be
converted to correlation by dividing by <span class="math inline">\sigma^2_{id} + \sigma^2_{cell} +
\sigma^2_\varepsilon</span>, and this gives the results from above. This
example generalizes to any number of variance components <span class="citation">(Pinheiro and Bates 2000)</span>.</p>
</div>
<div class="section level4">
<h4 id="variation-with-multiple-subsets-of-the-data">Variation with multiple subsets of the data<a class="anchor" aria-label="anchor" href="#variation-with-multiple-subsets-of-the-data"></a>
</h4>
<p>The linear mixed model underlying <code>variancePartition</code>
allows the effect of one variable to depend on the value of another
variable. Statistically, this is called a varying coefficient model
<span class="citation">(Pinheiro and Bates 2000; Galecki and Burzykowski
2013)</span>. This model arises in <code>variancePartition</code>
analysis when the variation explained by individual depends on tissue or
cell type.</p>
<p>A given sample is only from one cell type, so this analysis asks a
question about a subset of the data. The the data is implicitly divided
into subsets base on cell type and variation explained by individual is
evaluated within each subset. The data is not actually divided onto
subset, but the statistical model essentially examples samples with each
cell type. This subsetting means that the variance fractions do not sum
to 1.</p>
<p>Consider a concrete example with variation from across individual and
cell types (T-cells and monocytes) with data from the <span class="math inline">i^{th}</span> sample from the <span class="math inline">k^{th}</span> individual, sex of <span class="math inline">s</span> and cell type <span class="math inline">c</span>. Modeling the variation across individuals
within cell type corresponds to <span class="math display">\begin{eqnarray}
  y_{i,k,s,c} = \mu + Z^{(sex)} \alpha_{i,s} + Z^{(Tcell| id)}
\alpha_{i,k,c} + Z^{(monocyte| id)} \alpha_{i,k,c} + e_{i,k,s,c}
\end{eqnarray}</span></p>
<p>with corresponding variance components:</p>
<table class="table">
<colgroup>
<col width="56%">
<col width="43%">
</colgroup>
<thead><tr class="header">
<th>Variance component</th>
<th>Interpretation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\sigma^2_{sex}</span></td>
<td>variance across sex (which is the same for all cell types)</td>
</tr>
<tr class="even">
<td><span class="math inline">\sigma^2_{(Tcell| id)}</span></td>
<td>variance across individuals within T-cells</td>
</tr>
<tr class="odd">
<td><span class="math inline">\sigma^2_{(monocyte| id)}</span></td>
<td>variance across individuals within monocytes</td>
</tr>
<tr class="even">
<td><span class="math inline">\sigma^2_\varepsilon</span></td>
<td>residual variance</td>
</tr>
</tbody>
</table>
<p>Since the dataset is now divided into multiple subsets, direct
interpretation of the fraction of variation explained (FVE) as
intra-class correlation does not apply. Instead, we compute a
“pseudo-FVE” by approximating the total variance attributable to cell
type by using a weighted average of the within cell type variances
weighted by the sample size within each cell type. Thus the values of
pseudo-FVE do not have the simple interpretation as in the standard
application of <code>variancePartition</code>, but allows ranking of
variables based on genome-wide contribution to variance and analysis of
gene-level results.</p>
</div>
</div>
<div class="section level3">
<h3 id="variance-partitioning-and-differential-expression">Variance partitioning and differential expression<a class="anchor" aria-label="anchor" href="#variance-partitioning-and-differential-expression"></a>
</h3>
<p>Differential expression (DE) is widely used to identify gene which
show difference is expression between two subsets of the data (i.e. case
versus controls). For a single gene, DE analysis measures the difference
in mean expression between the two subsets. (Since expression is usually
analyzed on a log scale, DE results are usually shown in terms of log
fold changes between the two subsets ). In the Figure, consider two
simulated examples of a gene whose expression differs between males and
females. The mean expression in males is 0 and the mean expression in
females is 2 in both cases. Therefore, the fold change is 2 in both
cases.</p>
<p>However, the fraction of expression variation explained by sex is
very different in these two examples. In example A, there is very little
variation <em>within</em> each sex, so that variation <em>between</em>
sexes is very high at 91.1%. Conversely, example B shows high variation
<em>within</em> sexes, so that variation <em>between</em> sexes is only
17.8%.</p>
<p>The fact that the fold change or the fraction of variation is
significantly different from 0 indicates differential expression between
the two sexes. Yet these two statistics have different interpretations.
The fold change from DE analysis tests a difference in means between two
sexes. The fraction of variation explained compares the variation
explained by sex to the total variation.</p>
<p>Thus the fraction of variation explained reported by
<code>variancePartition</code> reflects as different aspect of the data
not captured by DE analysis.</p>
<p><img src="variancePartition_files/figure-html/DE-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="section level4">
<h4 id="modelling-error-in-gene-expression-measurements">Modelling error in gene expression measurements<a class="anchor" aria-label="anchor" href="#modelling-error-in-gene-expression-measurements"></a>
</h4>
<p>Uncertainty in the measurement of gene expression can be modeled with
precision weights and tests of differentially expression using
<code><a href="https://rdrr.io/pkg/limma/man/voom.html" class="external-link">limma::voom()</a></code> model this uncertainty directly with a
heteroskedastic linear regression <span class="citation">(Law et al.
2014)</span>. <code>variancePartition</code> can use these precision
weights in a heteroskedastic linear mixed model implemented in
<code>lme4</code> <span class="citation">(Bates et al. 2015)</span>.
These precision weights are used seamlessly by calling
<code><a href="../reference/fitVarPartModel-method.html">fitVarPartModel()</a></code> or <code><a href="../reference/fitExtractVarPartModel-method.html">fitExtractVarPartModel()</a></code>
on the output of <code><a href="https://rdrr.io/pkg/limma/man/voom.html" class="external-link">limma::voom()</a></code>. Otherwise the user can
specify the weights with the <code>weightsMatrix</code> parameter.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<details><pre><code><span><span class="co">## R version 4.4.2 (2024-10-31)</span></span>
<span><span class="co">## Platform: aarch64-apple-darwin23.6.0</span></span>
<span><span class="co">## Running under: macOS Sonoma 14.7.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /Users/gabrielhoffman/prog/R-4.4.2/lib/libRblas.dylib </span></span>
<span><span class="co">## LAPACK: /opt/homebrew/Cellar/r/4.5.1/lib/R/lib/libRlapack.dylib;  LAPACK version 3.12.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: America/New_York</span></span>
<span><span class="co">## tzcode source: internal</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] dendextend_1.19.0           ballgown_2.25.1             DESeq2_1.46.0              </span></span>
<span><span class="co">##  [4] SummarizedExperiment_1.36.0 Biobase_2.66.0              MatrixGenerics_1.18.1      </span></span>
<span><span class="co">##  [7] matrixStats_1.5.0           GenomicRanges_1.58.0        GenomeInfoDb_1.42.3        </span></span>
<span><span class="co">## [10] IRanges_2.40.1              S4Vectors_0.44.0            BiocGenerics_0.52.0        </span></span>
<span><span class="co">## [13] edgeR_4.4.2                 lme4_1.1-37                 Matrix_1.7-3               </span></span>
<span><span class="co">## [16] variancePartition_1.37.2    BiocParallel_1.40.0         limma_3.62.2               </span></span>
<span><span class="co">## [19] ggplot2_3.5.2              </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] RColorBrewer_1.1-3       jsonlite_2.0.0           magrittr_2.0.3          </span></span>
<span><span class="co">##   [4] farver_2.1.2             nloptr_2.2.1             rmarkdown_2.29          </span></span>
<span><span class="co">##   [7] fs_1.6.6                 BiocIO_1.16.0            zlibbioc_1.52.0         </span></span>
<span><span class="co">##  [10] ragg_1.4.0               vctrs_0.6.5              memoise_2.0.1           </span></span>
<span><span class="co">##  [13] minqa_1.2.8              Rsamtools_2.22.0         RCurl_1.98-1.17         </span></span>
<span><span class="co">##  [16] htmltools_0.5.8.1        S4Arrays_1.6.0           curl_6.3.0              </span></span>
<span><span class="co">##  [19] broom_1.0.8              SparseArray_1.6.2        sass_0.4.10             </span></span>
<span><span class="co">##  [22] KernSmooth_2.23-26       bslib_0.9.0              htmlwidgets_1.6.4       </span></span>
<span><span class="co">##  [25] desc_1.4.3               pbkrtest_0.5.4           plyr_1.8.9              </span></span>
<span><span class="co">##  [28] cachem_1.1.0             GenomicAlignments_1.42.0 lifecycle_1.0.4         </span></span>
<span><span class="co">##  [31] iterators_1.0.14         pkgconfig_2.0.3          R6_2.6.1                </span></span>
<span><span class="co">##  [34] fastmap_1.2.0            GenomeInfoDbData_1.2.13  rbibutils_2.3           </span></span>
<span><span class="co">##  [37] digest_0.6.37            numDeriv_2016.8-1.1      colorspace_2.1-1        </span></span>
<span><span class="co">##  [40] AnnotationDbi_1.68.0     textshaping_1.0.1        RSQLite_2.4.1           </span></span>
<span><span class="co">##  [43] labeling_0.4.3           mgcv_1.9-3               httr_1.4.7              </span></span>
<span><span class="co">##  [46] abind_1.4-8              compiler_4.4.2           bit64_4.6.0-1           </span></span>
<span><span class="co">##  [49] aod_1.3.3                withr_3.0.2              backports_1.5.0         </span></span>
<span><span class="co">##  [52] viridis_0.6.5            DBI_1.2.3                gplots_3.2.0            </span></span>
<span><span class="co">##  [55] MASS_7.3-65              DelayedArray_0.32.0      rjson_0.2.23            </span></span>
<span><span class="co">##  [58] corpcor_1.6.10           gtools_3.9.5             caTools_1.18.3          </span></span>
<span><span class="co">##  [61] tools_4.4.2              remaCor_0.0.18           glue_1.8.0              </span></span>
<span><span class="co">##  [64] restfulr_0.0.15          nlme_3.1-168             grid_4.4.2              </span></span>
<span><span class="co">##  [67] reshape2_1.4.4           generics_0.1.4           sva_3.50.0              </span></span>
<span><span class="co">##  [70] gtable_0.3.6             tidyr_1.3.1              XVector_0.46.0          </span></span>
<span><span class="co">##  [73] pillar_1.10.2            stringr_1.5.1            genefilter_1.84.0       </span></span>
<span><span class="co">##  [76] splines_4.4.2            dplyr_1.1.4              lattice_0.22-7          </span></span>
<span><span class="co">##  [79] survival_3.8-3           rtracklayer_1.66.0       bit_4.6.0               </span></span>
<span><span class="co">##  [82] annotate_1.84.0          tidyselect_1.2.1         locfit_1.5-9.12         </span></span>
<span><span class="co">##  [85] Biostrings_2.74.1        knitr_1.50               gridExtra_2.3           </span></span>
<span><span class="co">##  [88] reformulas_0.4.1         RhpcBLASctl_0.23-42      xfun_0.52               </span></span>
<span><span class="co">##  [91] statmod_1.5.0            stringi_1.8.7            UCSC.utils_1.2.0        </span></span>
<span><span class="co">##  [94] yaml_2.3.10              boot_1.3-31              evaluate_1.0.4          </span></span>
<span><span class="co">##  [97] codetools_0.2-20         tibble_3.3.0             cli_3.6.5               </span></span>
<span><span class="co">## [100] xtable_1.8-4             systemfonts_1.2.3        Rdpack_2.6.4            </span></span>
<span><span class="co">## [103] jquerylib_0.1.4          Rcpp_1.0.14              EnvStats_3.1.0          </span></span>
<span><span class="co">## [106] png_0.1-8                XML_3.99-0.18            parallel_4.4.2          </span></span>
<span><span class="co">## [109] pkgdown_2.1.3            blob_1.2.4               bitops_1.0-9            </span></span>
<span><span class="co">## [112] viridisLite_0.4.2        mvtnorm_1.3-3            lmerTest_3.1-3          </span></span>
<span><span class="co">## [115] scales_1.4.0             purrr_1.0.4              crayon_1.5.3            </span></span>
<span><span class="co">## [118] fANCOVA_0.6-1            rlang_1.1.6              cowplot_1.1.3           </span></span>
<span><span class="co">## [121] KEGGREST_1.46.0</span></span></code></pre>
</details>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Anders2015" class="csl-entry">
Anders, Simon, Paul Theodor Pyl, and Wolfgang Huber. 2015. <span>“<span class="nocase">HTSeq-A Python framework to work with high-throughput
sequencing data</span>.”</span> <em>Bioinformatics</em> 31 (2): 166–69.
<a href="https://doi.org/10.1093/bioinformatics/btu638" class="external-link">https://doi.org/10.1093/bioinformatics/btu638</a>.
</div>
<div id="ref-Bates2015" class="csl-entry">
Bates, D., M. Machler, B. Bolker, and S. Walker. 2015. <span>“<span class="nocase">Fitting Linear Mixed-Effects Models Using
lme4</span>.”</span> <em>Journal of Statistical Software</em> 67 (1). <a href="https://doi.org/10.18637/jss.v067.i01" class="external-link">https://doi.org/10.18637/jss.v067.i01</a>.
</div>
<div id="ref-Bray2015" class="csl-entry">
Bray, Nicolas L, Harold Pimentel, Páll Melsted, and Lior Pachter. 2016.
<span>“<span class="nocase">Near-optimal probabilistic RNA-seq
quantification</span>.”</span> <em>Nature Biotechnology</em> 34: 525–27.
<a href="https://doi.org/10.1038/nbt.3519" class="external-link">https://doi.org/10.1038/nbt.3519</a>.
</div>
<div id="ref-oligoBioc" class="csl-entry">
Carvalho, Benilton S, and Rafael A Irizarry. 2010. <span>“A Framework
for Oligonucleotide Microarray Preprocessing.”</span>
<em>Bioinformatics</em> (Oxford, UK) 26 (19): 2363–67. <a href="https://doi.org/10.1093/bioinformatics/btq431" class="external-link">https://doi.org/10.1093/bioinformatics/btq431</a>.
</div>
<div id="ref-Frazee2015" class="csl-entry">
Frazee, Alyssa C, Geo Pertea, Andrew E Jaffe, Ben Langmead, Steven L
Salzberg, and Jeffrey T Leek. 2015. <span>“<span class="nocase">Ballgown
bridges the gap between transcriptome assembly and expression
analysis</span>.”</span> <em>Nature Biotechnology</em> 33 (3): 243–46.
<a href="https://doi.org/10.1038/nbt.3172" class="external-link">https://doi.org/10.1038/nbt.3172</a>.
</div>
<div id="ref-Galecki2010" class="csl-entry">
Galecki, A., and T. Burzykowski. 2013. <em><span class="nocase">Linear
Mixed Effects Modeling using R.</span></em> Springer.
</div>
<div id="ref-Law2014" class="csl-entry">
Law, C. W., Y. Chen, W. Shi, and G. K. Smyth. 2014. <span>“<span class="nocase">Voom: precision weights unlock linear model analysis
tools for RNA-seq read counts.</span>”</span> <em>Genome Biology</em> 15
(2): R29. <a href="https://doi.org/10.1186/gb-2014-15-2-r29" class="external-link">https://doi.org/10.1186/gb-2014-15-2-r29</a>.
</div>
<div id="ref-Li2011f" class="csl-entry">
Li, Bo, and Colin N Dewey. 2011. <span>“<span class="nocase">RSEM:
accurate transcript quantification from RNA-Seq data with or without a
reference genome</span>.”</span> <em>BMC Bioinformatics</em> 12 (1):
323. <a href="https://doi.org/10.1186/1471-2105-12-323" class="external-link">https://doi.org/10.1186/1471-2105-12-323</a>.
</div>
<div id="ref-Liao2014" class="csl-entry">
Liao, Yang, Gordon K. Smyth, and Wei Shi. 2014. <span>“<span class="nocase">FeatureCounts: An efficient general purpose program for
assigning sequence reads to genomic features</span>.”</span>
<em>Bioinformatics</em> 30 (7): 923–30. <a href="https://doi.org/10.1093/bioinformatics/btt656" class="external-link">https://doi.org/10.1093/bioinformatics/btt656</a>.
</div>
<div id="ref-Love2014" class="csl-entry">
Love, Michael I., Wolfgang Huber, and Simon Anders. 2014. <span>“<span class="nocase">Moderated estimation of fold change and dispersion for
RNA-seq data with DESeq2</span>.”</span> <em>Genome Biology</em> 15
(12): 550. <a href="https://doi.org/10.1186/s13059-014-0550-8" class="external-link">https://doi.org/10.1186/s13059-014-0550-8</a>.
</div>
<div id="ref-Patro2015" class="csl-entry">
Patro, Rob, Geet Duggal, and Carl Kingsford. 2015. <span>“<span class="nocase">Accurate, fast, and model-aware transcript expression
quantification with Salmon</span>.”</span> <em>Bioarxiv</em>, ahead of
print. <a href="https://doi.org/10.1101/021592" class="external-link">https://doi.org/10.1101/021592</a>.
</div>
<div id="ref-Patro2014" class="csl-entry">
Patro, Rob, Stephen M Mount, and Carl Kingsford. 2014. <span>“<span class="nocase">Sailfish enables alignment-free isoform quantification
from RNA-seq reads using lightweight algorithms</span>.”</span>
<em>Nature Biotechnology</em> 32 (5): 462–64. <a href="https://doi.org/10.1038/nbt.2862" class="external-link">https://doi.org/10.1038/nbt.2862</a>.
</div>
<div id="ref-Pinheiro2000" class="csl-entry">
Pinheiro, J. C., and D. M. Bates. 2000. <em><a href="https://www.ncbi.nlm.nih.gov/pubmed/40509311" class="external-link"><span class="nocase">Mixed-Effects Models in S and S-Plus</span></a></em>.
Springer.
</div>
<div id="ref-Robinson2010c" class="csl-entry">
Robinson, M. D., and A. Oshlack. 2010. <span>“<span class="nocase">A
scaling normalization method for differential expression analysis of
RNA-seq data.</span>”</span> <em>Genome Biology</em> 11 (3): R25. <a href="https://doi.org/10.1186/gb-2010-11-3-r25" class="external-link">https://doi.org/10.1186/gb-2010-11-3-r25</a>.
</div>
<div id="ref-Soneson2015" class="csl-entry">
Soneson, Charlotte, Michael I. Love, and Mark D. Robinson. 2015.
<span>“<span class="nocase">Differential analyses for RNA-seq:
transcript-level estimates improve gene-level inferences</span>.”</span>
<em>F1000Research</em> 4 (0): 1521. <a href="https://doi.org/10.12688/f1000research.7563.2" class="external-link">https://doi.org/10.12688/f1000research.7563.2</a>.
</div>
<div id="ref-Trapnell2010" class="csl-entry">
Trapnell, Cole, Brian a Williams, Geo Pertea, et al. 2010. <span>“<span class="nocase">Transcript assembly and quantification by RNA-Seq reveals
unannotated transcripts and isoform switching during cell
differentiation</span>.”</span> <em>Nature Biotechnology</em> 28 (5):
511–15. <a href="https://doi.org/10.1038/nbt.1621" class="external-link">https://doi.org/10.1038/nbt.1621</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="http://gabrielhoffman.github.io" class="external-link">Gabriel Hoffman</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
